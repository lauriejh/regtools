<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to regtools • regtools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to regtools">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">regtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Introduction%20to%20regtools.html">Introduction to regtools</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/amslala/regtools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to regtools</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/amslala/regtools/blob/HEAD/vignettes/Introduction%20to%20regtools.Rmd" class="external-link"><code>vignettes/Introduction to regtools.Rmd</code></a></small>
      <div class="d-none name"><code>Introduction to regtools.Rmd</code></div>
    </div>

    
    
<p><strong>regtools</strong> aims to facilitate the manipulation,
analysis and visualization of health and population registers and
capitalize on their characteristics.</p>
<p>Researchers with access to microdata from health and/or
administrative registers in Norway can use {regtools} to streamline
their initial analytical process. The package includes functions for
data preprocessing, linkage, and the computation of relevant statistics
and visualizations, such as stratified frequencies, incidence and
prevalence rates.</p>
<p>This vignette introduces you to regtool’s main functions and shows
examples of how to use them with individual-level data.</p>
<div class="section level2">
<h2 id="package-datasets">Package datasets<a class="anchor" aria-label="anchor" href="#package-datasets"></a>
</h2>
<p>To exemplify the main functions of the package, we have included a
couple of illustrative simulated datasets. These datasets are also used
in the examples specified in the functions’ documentation.</p>
<p><em>Note: the included datasets are large in size to parallel the
size you would normally encounter when working with real
microdata.</em></p>
<p>The dataset <code>diag_df</code> is a tibble with simulated
individual-level diagnostic data. It is documented in
<code><a href="../reference/diag_df.html">?diag_df</a></code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">diag_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [30,024 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ id       : chr [1:30024] "P000000037" "P000000052" "P000000059" "P000000111" ...</span></span>
<span><span class="co">#&gt;  $ code     : chr [1:30024] "F773" "F1011" "F898" "F1010" ...</span></span>
<span><span class="co">#&gt;  $ diag_year: int [1:30024] 2012 2017 2014 2015 2018 2020 2012 2017 2020 2015 ...</span></span></code></pre></div>
<p>The dataset <code>var_df</code> is a tibble with simulated
individual-level time-varying data. It is documented in
<code><a href="../reference/var_df.html">?var_df</a></code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">var_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [270,216 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ id          : chr [1:270216] "P000000037" "P000000037" "P000000037" "P000000037" ...</span></span>
<span><span class="co">#&gt;  $ year_varying: int [1:270216] 2012 2013 2014 2015 2016 2017 2018 2019 2020 2012 ...</span></span>
<span><span class="co">#&gt;  $ varying_code: chr [1:270216] "1146" "1146" "1146" "1756" ...</span></span></code></pre></div>
<p>The dataset <code>invar_df</code> is a tibble with simulated
individual-level time-invariant data. It is documented in
<code><a href="../reference/invar_df.html">?invar_df</a></code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">invar_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [30,024 × 4] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ id               : chr [1:30024] "P000000037" "P000000052" "P000000059" "P000000111" ...</span></span>
<span><span class="co">#&gt;  $ sex              : Factor w/ 2 levels "0","1": 1 2 1 2 1 1 2 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ y_birth          : int [1:30024] 2001 2009 2004 2006 2003 2000 2003 2008 2004 2000 ...</span></span>
<span><span class="co">#&gt;  $ innvandringsgrunn: chr [1:30024] "FAMM" "UTD" "FAMM" "FAMM" ...</span></span></code></pre></div>
<p>All the datasets above have been created using the
<code>simulate_dataset()</code> function included in this package. The
exact code used to create them can be found in the folder
<code>/data-raw</code> in the package’s source code.</p>
<p>Besides the main diagnostic and sociodemographic datasets included in
the package, there are also two datasets included to facilitate running
examples:</p>
<ul>
<li><p><code>kommuner_2016</code>: data.frame including all municipality
codes in Norway valid in 2016.</p></li>
<li><p><code>linked_df</code>: tibble including linked diagnostic,
time-invariant and time-varying data.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="general-features">General features<a class="anchor" aria-label="anchor" href="#general-features"></a>
</h2>
<p>The majority of functions create log files to encourage
reproducibility and consistency across research projects. Additionally,
each function provides clear console feedback after it executes
important operations (filter, select, join, etc)</p>
<p>For the next examples, we can initialize a temporary log file:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Vignette log file"</span>, file <span class="op">=</span> <span class="va">log_file</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-reading-and-validation">Data reading and validation<a class="anchor" aria-label="anchor" href="#data-reading-and-validation"></a>
</h2>
<p>Generally, researchers working with individual level registry data
(in Norway) will find their datasets divided (and delivered) in three
different categories:</p>
<ul>
<li><p><strong>Diagnostic data:</strong> normally containing unique
personal identifier (id), date of diagnostic even, and diagnosis code
(such as ICD-10 or ICP-2). For instance, datasets from NPR (Norwegian
Patient Registry) or KUHR.</p></li>
<li><p><strong>Time-invariandata:</strong> sociodemographic data such as
date of birth, immigration background, etc.</p></li>
<li><p><strong>Time-varying data:</strong> sociodemographic data such as
place of residence or marital status. This type of information usually
is updated quarterly or yearly in administrative registries.</p></li>
</ul>
<p>Assuming a researcher would want to compute sex-stratified prevalence
rates for a certain diagnosis, at least they would need a diagnostic
dataset and a time-invariant dataset (including sex).</p>
<p>The functions <code><a href="../reference/read_demo_data.html">read_demo_data()</a></code> and
<code><a href="../reference/read_diag_data.html">read_diag_data()</a></code> check the dataset’s minimum requirements,
as well as giving a quick summary of the dataset’s structure. You need
to specify the column names corresponding to the id and date variables
(see the function documentation for more info).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diag_csv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"diag_data.csv"</span>, package <span class="op">=</span> <span class="st">"regtools"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">diag_data_validated</span> <span class="op">&lt;-</span> <span class="fu">regtools</span><span class="fu">::</span><span class="fu"><a href="../reference/read_diag_data.html">read_diag_data</a></span><span class="op">(</span><span class="va">diag_csv</span>,</span>
<span>                                                 id_col <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                                                 date_col <span class="op">=</span> <span class="st">"diag_year"</span>,</span>
<span>                                                 log_path <span class="op">=</span> <span class="va">log_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading C:/Users/ALMS/AppData/Local/Temp/RtmpkPSwZq/temp_libpath5da84c6a2783/regtools/extdata/diag_data.csv file...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Succesfully read file: C:/Users/ALMS/AppData/Local/Temp/RtmpkPSwZq/temp_libpath5da84c6a2783/regtools/extdata/diag_data.csv</span></span>
<span><span class="co">#&gt; Checking column requirements:</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> ID column</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Code column</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Date column</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">────────────────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Diagnostic dataset succesfully read and columns validated</span></span></span>
<span><span class="co"><span style="color: #00BB00; font-weight: bold;">#&gt; </span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Data Summary</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Number of rows: <span style="color: #0000BB;">30024</span>. Number of columns: <span style="color: #0000BB;">3</span>.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 'data.frame':    30024 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;  $ id       : chr  "P000000037" "P000000052" "P000000059" "P000000111" ...</span></span>
<span><span class="co">#&gt;  $ code     : chr  "F773" "F1011" "F898" "F1010" ...</span></span>
<span><span class="co">#&gt;  $ diag_year: int  2012 2017 2014 2015 2018 2020 2012 2017 2020 2015 ...</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo_csv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"invar_data.csv"</span>, package <span class="op">=</span> <span class="st">"regtools"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">demo_data_validated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_demo_data.html">read_demo_data</a></span><span class="op">(</span><span class="va">demo_csv</span>, </span>
<span>                                      data_type <span class="op">=</span> <span class="st">"t_invariant"</span>,</span>
<span>                                      id_col <span class="op">=</span> <span class="st">"id"</span>, </span>
<span>                                      log_path <span class="op">=</span> <span class="va">log_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading C:/Users/ALMS/AppData/Local/Temp/RtmpkPSwZq/temp_libpath5da84c6a2783/regtools/extdata/invar_data.csv file...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Succesfully read file: C:/Users/ALMS/AppData/Local/Temp/RtmpkPSwZq/temp_libpath5da84c6a2783/regtools/extdata/invar_data.csv</span></span>
<span><span class="co">#&gt; Checking column requirements:</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> ID column</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Date column</span></span>
<span><span class="co">#&gt; Data type: time invariant. Checking requirements...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No duplicate IDs</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">────────────────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Demographic dataset succesfully read and columns validated</span></span></span>
<span><span class="co"><span style="color: #00BB00; font-weight: bold;">#&gt; </span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Data Summary</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Number of rows: <span style="color: #0000BB;">30024</span>. Number of columns: <span style="color: #0000BB;">4</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Unique IDs in dataset: <span style="color: #0000BB;">30024</span>.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 'data.frame':    30024 obs. of  4 variables:</span></span>
<span><span class="co">#&gt;  $ id               : chr  "P000000037" "P000000052" "P000000059" "P000000111" ...</span></span>
<span><span class="co">#&gt;  $ sex              : int  0 1 0 1 0 0 1 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ y_birth          : int  2001 2009 2004 2006 2003 2000 2003 2008 2004 2000 ...</span></span>
<span><span class="co">#&gt;  $ innvandringsgrunn: chr  "FAMM" "UTD" "FAMM" "FAMM" ...</span></span></code></pre></div>
<p>Note: the read functions only check for minimum requirements, your
real datasets can contain additional variables/columns. For example, NPR
sometimes includes sex and age information for each individual in the
same diagnostic dataset.</p>
</div>
<div class="section level2">
<h2 id="data-filtering">Data filtering<a class="anchor" aria-label="anchor" href="#data-filtering"></a>
</h2>
<p>In most cases, the real microdata you will be working with is very
large. Therefore, regtools encourages a filter first approach. The
following functions are useful to keep only relevant cases to your
analysis.</p>
<div class="section level3">
<h3 id="filter-diagnostic-data">Filter diagnostic data<a class="anchor" aria-label="anchor" href="#filter-diagnostic-data"></a>
</h3>
<p>To filter the diagnostic dataset, you should use
<code><a href="../reference/filter_diag.html">filter_diag()</a></code>. This function validates that the ICD-10
codes you are indeed valid. If they are valid, it filters the given
diagnostic dataset to keep only the observations with the relevant
ICD-10 codes.</p>
<p>For example, to keep only the observations that either have the
ICD-10 code <em>F840</em> or <em>F841</em>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filtered_diag_codes</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/filter_diag.html">filter_diag</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diag_df</span>,</span>
<span>                                    codes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F840"</span>, <span class="st">"F841"</span><span class="op">)</span>,</span>
<span>                                    id_col <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                                    code_col <span class="op">=</span> <span class="st">"code"</span>,</span>
<span>                                    log_path <span class="op">=</span> <span class="va">log_file</span></span>
<span>                                    <span class="op">)</span></span>
<span><span class="co">#&gt; Checking that code exists in ICD-10 code list...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Selected ICD-10 codes are valid: F840, F841</span></span>
<span><span class="co">#&gt; Filtering data by selected ICD-10 codes...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">────────────────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Diagnostic dataset succesfully filtered</span></span></span>
<span><span class="co"><span style="color: #00BB00; font-weight: bold;">#&gt; </span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Filtered <span style="color: #0000BB;">29965</span> rows (<span style="font-weight: bold;">99.8%</span> removed)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Data Summary</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── After filtering:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Remaining number of rows: <span style="color: #0000BB;">59</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Remaining number of columns: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Unique IDs in dataset: <span style="color: #0000BB;">59</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> ICD-10 codes in dataset: <span style="color: #0000BB;">F841</span> and <span style="color: #0000BB;">F840</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; tibble [59 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ id       : chr [1:59] "P000010070" "P000010584" "P000044255" "P000139916" ...</span></span>
<span><span class="co">#&gt;  $ code     : chr [1:59] "F840" "F840" "F840" "F840" ...</span></span>
<span><span class="co">#&gt;  $ diag_year: int [1:59] 2019 2016 2019 2015 2013 2015 2015 2015 2019 2016 ...</span></span></code></pre></div>
<p>Alternatively, it is also possible to filter by pattern/family of
codes. For example, to keep the observations with all codes starting
with <em>F45</em> or <em>F84</em>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filtered_diag_pattern</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/filter_diag.html">filter_diag</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diag_df</span>,</span>
<span>                                      pattern_codes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F45"</span>, <span class="st">"F84"</span><span class="op">)</span>,</span>
<span>                                      id_col <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                                      code_col <span class="op">=</span> <span class="st">"code"</span>,</span>
<span>                                      log_path <span class="op">=</span> <span class="va">log_file</span></span>
<span>                                      <span class="op">)</span></span>
<span><span class="co">#&gt; Checking that code exists in ICD-10 code list...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Selected ICD-10 codes are valid: F45, F84</span></span>
<span><span class="co">#&gt; Filtering data by selected ICD-10 codes...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">────────────────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Diagnostic dataset succesfully filtered</span></span></span>
<span><span class="co"><span style="color: #00BB00; font-weight: bold;">#&gt; </span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Filtered <span style="color: #0000BB;">29333</span> rows (<span style="font-weight: bold;">97.7%</span> removed)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Data Summary</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── After filtering:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Remaining number of rows: <span style="color: #0000BB;">691</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Remaining number of columns: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Unique IDs in dataset: <span style="color: #0000BB;">691</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> ICD-10 codes in dataset: <span style="color: #0000BB;">F848</span>, <span style="color: #0000BB;">F845</span>, <span style="color: #0000BB;">F4520</span>, <span style="color: #0000BB;">F451</span>, <span style="color: #0000BB;">F843</span>, <span style="color: #0000BB;">F454</span>, <span style="color: #0000BB;">F458</span>, <span style="color: #0000BB;">F455</span>, <span style="color: #0000BB;">F45</span>, <span style="color: #0000BB;">F456</span>, <span style="color: #0000BB;">F4529</span>, <span style="color: #0000BB;">F844</span>, <span style="color: #0000BB;">F450</span>, <span style="color: #0000BB;">F84</span>, <span style="color: #0000BB;">F4542</span>, <span style="color: #0000BB;">F842</span>, <span style="color: #0000BB;">F847</span>, <span style="color: #0000BB;">F453</span>, …, <span style="color: #0000BB;">F452</span>, and <span style="color: #0000BB;">F846</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; tibble [691 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ id       : chr [1:691] "P000000704" "P000000886" "P000001615" "P000004197" ...</span></span>
<span><span class="co">#&gt;  $ code     : chr [1:691] "F4522" "F450" "F845" "F4520" ...</span></span>
<span><span class="co">#&gt;  $ diag_year: int [1:691] 2016 2017 2020 2019 2016 2019 2020 2013 2019 2016 ...</span></span></code></pre></div>
<p>To further refine the filter of a diagnostic dataset, the
<code><a href="../reference/curate_diag.html">curate_diag()</a></code> provides additional options. For example, you
can keep only individuals (identified by an unique person identifier)
with at least a minimum number of diagnostic events or only keep
first-time diagnosis (when a date variable is available). Look at the
specific function’s documentation for more info.</p>
</div>
<div class="section level3">
<h3 id="filter-time-varying-and-time-invariant-data">Filter time-varying and time-invariant data<a class="anchor" aria-label="anchor" href="#filter-time-varying-and-time-invariant-data"></a>
</h3>
<p>To filter both the time-varying and time-invariant datasets, you
should use <code><a href="../reference/filter_demo.html">filter_demo()</a></code>. This function filters the given
dataset to keep only the observations with the relevant
chracteristics.</p>
<p>For example, to only keep observations where the individuals have
resided in the municiplality “1146” between the years 2012-2015:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filtered_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_demo.html">filter_demo</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">var_df</span>,</span>
<span>                            data_type <span class="op">=</span> <span class="st">"t_variant"</span>,</span>
<span>                            filter_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"year_varying"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2012</span><span class="op">:</span><span class="fl">2015</span><span class="op">)</span>, <span class="st">"varying_code"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1146"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            log_path <span class="op">=</span> <span class="va">log_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; Filtering time-variant dataset...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Filtered time-variant by 'year_varying and varying_code' column(s)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Filtered <span style="color: #0000BB;">269648</span> rows (<span style="font-weight: bold;">99.8%</span> removed)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> The dataset has no NAs or they are coded in a different format.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">────────────────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Demographic dataset succesfully filtered</span></span></span>
<span><span class="co"><span style="color: #00BB00; font-weight: bold;">#&gt; </span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Data Summary</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── After filtering:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Remaining number of rows: <span style="color: #0000BB;">568</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Remaining number of columns: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; tibble [568 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ id          : chr [1:568] "P000000037" "P000000037" "P000000037" "P000002133" ...</span></span>
<span><span class="co">#&gt;  $ year_varying: int [1:568] 2012 2013 2014 2012 2013 2014 2015 2012 2013 2014 ...</span></span>
<span><span class="co">#&gt;  $ varying_code: chr [1:568] "1146" "1146" "1146" "1146" ...</span></span></code></pre></div>
<p>In the case of time-invariant data, to keep only individuals with
year of birth between 2006-2008 and reason of immigration “FAMM” or
“UTD”:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filtered_invar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_demo.html">filter_demo</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">invar_df</span>, data_type <span class="op">=</span> <span class="st">"t_invariant"</span>,</span>
<span>                              filter_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"y_birth"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2010</span><span class="op">:</span><span class="fl">2018</span><span class="op">)</span>, <span class="st">"innvandringsgrunn"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ARB"</span>,<span class="st">"NRD"</span>, <span class="st">"UKJ"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                              rm_na <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                              log_path <span class="op">=</span> <span class="va">log_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; Filtering time-invariant dataset...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Filtered time-invariant dataset by 'y_birth and innvandringsgrunn' column(s)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Filtered <span style="color: #0000BB;">29333</span> rows (<span style="font-weight: bold;">97.7%</span> removed)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">────────────────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Demographic dataset succesfully filtered</span></span></span>
<span><span class="co"><span style="color: #00BB00; font-weight: bold;">#&gt; </span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Data Summary</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── After filtering:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Remaining number of rows: <span style="color: #0000BB;">691</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Remaining number of columns: <span style="color: #0000BB;">4</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; tibble [691 × 4] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ id               : chr [1:691] "P000000704" "P000000886" "P000001615" "P000004197" ...</span></span>
<span><span class="co">#&gt;  $ sex              : Factor w/ 2 levels "0","1": 2 1 1 2 1 2 2 2 2 2 ...</span></span>
<span><span class="co">#&gt;  $ y_birth          : int [1:691] 2016 2016 2011 2010 2014 2015 2012 2010 2016 2011 ...</span></span>
<span><span class="co">#&gt;  $ innvandringsgrunn: chr [1:691] "ARB" "UKJ" "ARB" "UKJ" ...</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="linkage">Linkage<a class="anchor" aria-label="anchor" href="#linkage"></a>
</h2>
<p>After filtering the datasets, we can link them using the individuals
unique personal identifier. Depending on the type of analysis and
relevant variables, it might not be necessary to link any datasets.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linked_diag_inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/link_diag_demo.html">link_diag_demo</a></span><span class="op">(</span>data_diag <span class="op">=</span> <span class="va">filtered_diag_pattern</span>,</span>
<span>                                  data_demo_inv <span class="op">=</span> <span class="va">filtered_invar</span>,</span>
<span>                                  id_col <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                                  log_path <span class="op">=</span> <span class="va">log_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining diagnostic data with time-invariant demographic data...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Datasets succesfully linked: filtered_diag_pattern, filtered_invar</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Data Summary</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> After joining added <span style="color: #0000BB;">3</span> columns to 'filtered_diag_pattern': sex, y_birth, and innvandringsgrunn</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Rows in 'filtered_diag_pattern': <span style="color: #0000BB;">691</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Rows in 'filtered_invar': <span style="color: #0000BB;">691</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Total matched rows: <span style="color: #0000BB;">691</span></span></span></code></pre></div>
<p>The resulting dataset from <code><a href="../reference/link_diag_demo.html">link_diag_demo()</a></code>is a minimal
tidy dataset that you can then use to run other analytical
functions.</p>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
</div>
<div class="section level2">
<h2 id="visualize">Visualize<a class="anchor" aria-label="anchor" href="#visualize"></a>
</h2>
</div>
<div class="section level2">
<h2 id="other-useful-functions">Other useful functions<a class="anchor" aria-label="anchor" href="#other-useful-functions"></a>
</h2>
<div class="section level3">
<h3 id="simulate-dataset">Simulate dataset<a class="anchor" aria-label="anchor" href="#simulate-dataset"></a>
</h3>
<p>Simulates a dataset. In some cases uses API, not able to be run
inside TSD</p>
</div>
<div class="section level3">
<h3 id="harmonize-municipality-codes">Harmonize municipality codes<a class="anchor" aria-label="anchor" href="#harmonize-municipality-codes"></a>
</h3>
<p>Harmonizes codes. Some of the challenges of working with
registries.</p>
</div>
<div class="section level3">
<h3 id="get-population-ssb">Get population SSB<a class="anchor" aria-label="anchor" href="#get-population-ssb"></a>
</h3>
<p>API SSB: not able to run inside of TSD</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alejandra Martinez Sanchez.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
