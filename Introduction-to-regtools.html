<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Introduction to regtools</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to regtools</h1>



<p><strong>regtools</strong> aims to facilitate the manipulation,
analysis and visualization of health and population registers and
capitalize on their characteristics.</p>
<p>Researchers with access to microdata from health and/or
administrative registers in Norway can use {regtools} to streamline
their initial analytical process. The package includes functions for
data preprocessing, linkage, and the computation of relevant statistics
and visualizations, such as stratified frequencies, incidence and
prevalence rates.</p>
<p>This vignette introduces you to regtool’s main functions and shows
examples of how to use them with individual-level data.</p>
<div id="package-datasets" class="section level2">
<h2>Package datasets</h2>
<p>To exemplify the main functions of the package, we have included a
couple of illustrative simulated datasets. These datasets are also used
in the examples specified in the functions’ documentation.</p>
<p><em>Note: the included datasets are large in size to parallel the
size you would normally encounter when working with real
microdata.</em></p>
<p>The dataset <code>diag_df</code> is a tibble with simulated
individual-level diagnostic data. It is documented in
<code>?diag_df</code></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">str</span>(diag_df)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">#&gt; tibble [30,024 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#&gt;  $ id       : chr [1:30024] &quot;P000000037&quot; &quot;P000000052&quot; &quot;P000000059&quot; &quot;P000000111&quot; ...</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#&gt;  $ code     : chr [1:30024] &quot;F773&quot; &quot;F1011&quot; &quot;F898&quot; &quot;F1010&quot; ...</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#&gt;  $ diag_year: int [1:30024] 2012 2017 2014 2015 2018 2020 2012 2017 2020 2015 ...</span></span></code></pre></div>
<p>The dataset <code>var_df</code> is a tibble with simulated
individual-level time-varying data. It is documented in
<code>?var_df</code></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">str</span>(var_df)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#&gt; tibble [270,216 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt;  $ id          : chr [1:270216] &quot;P000000037&quot; &quot;P000000037&quot; &quot;P000000037&quot; &quot;P000000037&quot; ...</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt;  $ year_varying: int [1:270216] 2012 2013 2014 2015 2016 2017 2018 2019 2020 2012 ...</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt;  $ varying_code: chr [1:270216] &quot;1146&quot; &quot;1146&quot; &quot;1146&quot; &quot;1756&quot; ...</span></span></code></pre></div>
<p>The dataset <code>invar_df</code> is a tibble with simulated
individual-level time-invariant data. It is documented in
<code>?invar_df</code></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">str</span>(invar_df)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt; tibble [30,024 × 4] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt;  $ id               : chr [1:30024] &quot;P000000037&quot; &quot;P000000052&quot; &quot;P000000059&quot; &quot;P000000111&quot; ...</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt;  $ sex              : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 1 2 1 2 1 1 2 1 1 1 ...</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt;  $ y_birth          : int [1:30024] 2001 2009 2004 2006 2003 2000 2003 2008 2004 2000 ...</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt;  $ innvandringsgrunn: chr [1:30024] &quot;FAMM&quot; &quot;UTD&quot; &quot;FAMM&quot; &quot;FAMM&quot; ...</span></span></code></pre></div>
<p>All the datasets above have been created using the
<code>simulate_dataset()</code> function included in this package. The
exact code used to create them can be found in the folder
<code>/data-raw</code> in the package’s source code.</p>
<p>Besides the main diagnostic and sociodemographic datasets included in
the package, there are also two datasets included to facilitate running
examples:</p>
<ul>
<li><p><code>kommuner_2016</code>: data.frame including all municipality
codes in Norway valid in 2016.</p></li>
<li><p><code>linked_df</code>: tibble including linked diagnostic,
time-invariant and time-varying data.</p></li>
</ul>
</div>
<div id="general-features" class="section level2">
<h2>General features</h2>
<p>The majority of functions create log files to encourage
reproducibility and consistency across research projects. Additionally,
each function provides clear console feedback after it executes
important operations (filter, select, join, etc)</p>
<p>For the next examples, we can initialize a temporary log file:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>log_file <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Vignette log file&quot;</span>, <span class="at">file =</span> log_file)</span></code></pre></div>
</div>
<div id="data-reading-and-validation" class="section level2">
<h2>Data reading and validation</h2>
<p>Generally, researchers working with individual level registry data
(in Norway) will find their datasets divided (and delivered) in three
different categories:</p>
<ul>
<li><p><strong>Diagnostic data:</strong> normally containing unique
personal identifier (id), date of diagnostic even, and diagnosis code
(such as ICD-10 or ICP-2). For instance, datasets from NPR (Norwegian
Patient Registry) or KUHR.</p></li>
<li><p><strong>Time-invariandata:</strong> sociodemographic data such as
date of birth, immigration background, etc.</p></li>
<li><p><strong>Time-varying data:</strong> sociodemographic data such as
place of residence or marital status. This type of information usually
is updated quarterly or yearly in administrative registries.</p></li>
</ul>
<p>Assuming a researcher would want to compute sex-stratified prevalence
rates for a certain diagnosis, at least they would need a diagnostic
dataset and a time-invariant dataset (including sex).</p>
<p>The functions <code>read_demo_data()</code> and
<code>read_diag_data()</code> check the dataset’s minimum requirements,
as well as giving a quick summary of the dataset’s structure. You need
to specify the column names corresponding to the id and date variables
(see the function documentation for more info).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>diag_csv <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;diag_data.csv&quot;</span>, <span class="at">package =</span> <span class="st">&quot;regtools&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>diag_data_validated <span class="ot">&lt;-</span> <span class="fu">read_diag_data</span>(diag_csv,</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>                                      <span class="at">id_col =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>                                      <span class="at">date_col =</span> <span class="st">&quot;diag_year&quot;</span>,</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>                                      <span class="at">log_path =</span> log_file)</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; Reading C:/Users/ALMS/AppData/Local/Temp/RtmpOyelsF/temp_libpath4e30580f7a5b/regtools/extdata/diag_data.csv file...</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; ✔ Succesfully read file: C:/Users/ALMS/AppData/Local/Temp/RtmpOyelsF/temp_libpath4e30580f7a5b/regtools/extdata/diag_data.csv</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; Checking column requirements:</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; ✔ ID column</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; ✔ Code column</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; ✔ Date column</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; Diagnostic dataset succesfully read and columns validated</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt; ── Data Summary ────────────────────────────────────────────────────────────────</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; ℹ Number of rows: 30024. Number of columns: 3.</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt; &#39;data.frame&#39;:    30024 obs. of  3 variables:</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co">#&gt;  $ id       : chr  &quot;P000000037&quot; &quot;P000000052&quot; &quot;P000000059&quot; &quot;P000000111&quot; ...</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="co">#&gt;  $ code     : chr  &quot;F773&quot; &quot;F1011&quot; &quot;F898&quot; &quot;F1010&quot; ...</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="co">#&gt;  $ diag_year: int  2012 2017 2014 2015 2018 2020 2012 2017 2020 2015 ...</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>demo_csv <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;invar_data.csv&quot;</span>, <span class="at">package =</span> <span class="st">&quot;regtools&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>demo_data_validated <span class="ot">&lt;-</span> <span class="fu">read_demo_data</span>(demo_csv, </span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>                                      <span class="at">data_type =</span> <span class="st">&quot;t_invariant&quot;</span>,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>                                      <span class="at">id_col =</span> <span class="st">&quot;id&quot;</span>, </span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>                                      <span class="at">log_path =</span> log_file)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; Reading C:/Users/ALMS/AppData/Local/Temp/RtmpOyelsF/temp_libpath4e30580f7a5b/regtools/extdata/invar_data.csv file...</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; ✔ Succesfully read file: C:/Users/ALMS/AppData/Local/Temp/RtmpOyelsF/temp_libpath4e30580f7a5b/regtools/extdata/invar_data.csv</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt; Checking column requirements:</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; ✔ ID column</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; ✔ Date column</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; Data type: time invariant. Checking requirements...</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; ✔ No duplicate IDs</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; Demographic dataset succesfully read and columns validated</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; ── Data Summary ────────────────────────────────────────────────────────────────</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; ℹ Number of rows: 30024. Number of columns: 4.</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; ℹ Unique IDs in dataset: 30024.</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="co">#&gt; &#39;data.frame&#39;:    30024 obs. of  4 variables:</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="co">#&gt;  $ id               : chr  &quot;P000000037&quot; &quot;P000000052&quot; &quot;P000000059&quot; &quot;P000000111&quot; ...</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="co">#&gt;  $ sex              : int  0 1 0 1 0 0 1 0 0 0 ...</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a><span class="co">#&gt;  $ y_birth          : int  2001 2009 2004 2006 2003 2000 2003 2008 2004 2000 ...</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="co">#&gt;  $ innvandringsgrunn: chr  &quot;FAMM&quot; &quot;UTD&quot; &quot;FAMM&quot; &quot;FAMM&quot; ...</span></span></code></pre></div>
<p>Note: the read functions only check for minimum requirements, your
real datasets can contain additional variables/columns. For example, NPR
sometimes includes sex and age information for each individual in the
same diagnostic dataset.</p>
</div>
<div id="data-filtering" class="section level2">
<h2>Data filtering</h2>
<p>In most cases, the real microdata you will be working with is very
large. Therefore, regtools encourages a filter first approach. The
following functions are useful to keep only relevant cases to your
analysis.</p>
<div id="filter-diagnostic-data" class="section level3">
<h3>Filter diagnostic data</h3>
<p>To filter the diagnostic dataset, you should use
<code>filter_diag()</code>. This function validates that the ICD-10
codes you are indeed valid. If they are valid, it filters the given
diagnostic dataset to keep only the observations with the relevant
ICD-10 codes.</p>
<p>For example, to keep only the observations that either have the
ICD-10 code <em>F840</em> or <em>F841</em>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>filtered_diag_codes <span class="ot">&lt;-</span>  <span class="fu">filter_diag</span>(<span class="at">data =</span> diag_df,</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>                                    <span class="at">codes =</span> <span class="fu">c</span>(<span class="st">&quot;F840&quot;</span>, <span class="st">&quot;F841&quot;</span>),</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>                                    <span class="at">id_col =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>                                    <span class="at">code_col =</span> <span class="st">&quot;code&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>                                    <span class="at">log_path =</span> log_file</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>                                    )</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; Checking that code exists in ICD-10 code list...</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; ✔ Selected ICD-10 codes are valid: F840, F841</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; Filtering data by selected ICD-10 codes...</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; Diagnostic dataset succesfully filtered</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; ℹ Filtered 29965 rows (99.8% removed)</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; ── Data Summary ────────────────────────────────────────────────────────────────</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt; ── After filtering:</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt; ℹ Remaining number of rows: 59</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt; ℹ Remaining number of columns: 3</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt; ℹ Unique IDs in dataset: 59</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">#&gt; ℹ ICD-10 codes in dataset: F841 and F840</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="co">#&gt; tibble [59 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="co">#&gt;  $ id       : chr [1:59] &quot;P000010070&quot; &quot;P000010584&quot; &quot;P000044255&quot; &quot;P000139916&quot; ...</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="co">#&gt;  $ code     : chr [1:59] &quot;F840&quot; &quot;F840&quot; &quot;F840&quot; &quot;F840&quot; ...</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="co">#&gt;  $ diag_year: int [1:59] 2019 2016 2019 2015 2013 2015 2015 2015 2019 2016 ...</span></span></code></pre></div>
<p>Alternatively, it is also possible to filter by pattern/family of
codes. For example, to keep the observations with all codes starting
with <em>F45</em> or <em>F84</em>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>filtered_diag_pattern <span class="ot">&lt;-</span>  <span class="fu">filter_diag</span>(<span class="at">data =</span> diag_df,</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>                                      <span class="at">pattern_codes =</span> <span class="fu">c</span>(<span class="st">&quot;F45&quot;</span>, <span class="st">&quot;F84&quot;</span>),</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>                                      <span class="at">id_col =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>                                      <span class="at">code_col =</span> <span class="st">&quot;code&quot;</span>,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>                                      <span class="at">log_path =</span> log_file</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>                                      )</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; Checking that code exists in ICD-10 code list...</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; ✔ Selected ICD-10 codes are valid: F45, F84</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; Filtering data by selected ICD-10 codes...</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; Diagnostic dataset succesfully filtered</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; ℹ Filtered 29333 rows (97.7% removed)</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt; ── Data Summary ────────────────────────────────────────────────────────────────</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt; ── After filtering:</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt; ℹ Remaining number of rows: 691</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt; ℹ Remaining number of columns: 3</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="co">#&gt; ℹ Unique IDs in dataset: 691</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="co">#&gt; ℹ ICD-10 codes in dataset: F848, F845, F4520, F451, F843, F454, F458, F455, F45, F456, F4529, F844, F450, F84, F4542, F842, F847, F453, …, F452, and F846</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="co">#&gt; tibble [691 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="co">#&gt;  $ id       : chr [1:691] &quot;P000000704&quot; &quot;P000000886&quot; &quot;P000001615&quot; &quot;P000004197&quot; ...</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a><span class="co">#&gt;  $ code     : chr [1:691] &quot;F4522&quot; &quot;F450&quot; &quot;F845&quot; &quot;F4520&quot; ...</span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="co">#&gt;  $ diag_year: int [1:691] 2016 2017 2020 2019 2016 2019 2020 2013 2019 2016 ...</span></span></code></pre></div>
<p>To further refine the filter of a diagnostic dataset, the
<code>curate_diag()</code> provides additional options. For example, you
can keep only individuals (identified by an unique person identifier)
with at least a minimum number of diagnostic events or only keep
first-time diagnosis (when a date variable is available). Look at the
specific function’s documentation for more info.</p>
</div>
<div id="filter-time-varying-and-time-invariant-data" class="section level3">
<h3>Filter time-varying and time-invariant data</h3>
<p>To filter both the time-varying and time-invariant datasets, you
should use <code>filter_demo()</code>. This function filters the given
dataset to keep only the observations with the relevant
chracteristics.</p>
<p>For example, to only keep observations where the individuals have
resided in the municiplality “1146” between the years 2012-2015:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>filtered_var <span class="ot">&lt;-</span> <span class="fu">filter_demo</span>(<span class="at">data =</span> var_df,</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>                            <span class="at">data_type =</span> <span class="st">&quot;t_variant&quot;</span>,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>                            <span class="at">filter_param =</span> <span class="fu">list</span>(<span class="st">&quot;year_varying&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2012</span><span class="sc">:</span><span class="dv">2015</span>), <span class="st">&quot;varying_code&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;1146&quot;</span>)),</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>                            <span class="at">log_path =</span> log_file)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; Filtering time-variant dataset...</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; ✔ Filtered time-variant by &#39;year_varying and varying_code&#39; column(s)</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; ℹ Filtered 269648 rows (99.8% removed)</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; ! The dataset has no NAs or they are coded in a different format.</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; Demographic dataset succesfully filtered</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; ── Data Summary ────────────────────────────────────────────────────────────────</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; ── After filtering:</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt; ℹ Remaining number of rows: 568</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt; ℹ Remaining number of columns: 3</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#&gt; tibble [568 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co">#&gt;  $ id          : chr [1:568] &quot;P000000037&quot; &quot;P000000037&quot; &quot;P000000037&quot; &quot;P000002133&quot; ...</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">#&gt;  $ year_varying: int [1:568] 2012 2013 2014 2012 2013 2014 2015 2012 2013 2014 ...</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="co">#&gt;  $ varying_code: chr [1:568] &quot;1146&quot; &quot;1146&quot; &quot;1146&quot; &quot;1146&quot; ...</span></span></code></pre></div>
<p>In the case of time-invariant data, to keep only individuals with
year of birth between 2006-2008 and reason of immigration “FAMM” or
“UTD”:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>filtered_invar <span class="ot">&lt;-</span> <span class="fu">filter_demo</span>(<span class="at">data =</span> invar_df, <span class="at">data_type =</span> <span class="st">&quot;t_invariant&quot;</span>,</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>                              <span class="at">filter_param =</span> <span class="fu">list</span>(<span class="st">&quot;y_birth&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2010</span><span class="sc">:</span><span class="dv">2018</span>), <span class="st">&quot;innvandringsgrunn&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;ARB&quot;</span>,<span class="st">&quot;NRD&quot;</span>, <span class="st">&quot;UKJ&quot;</span>)),</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>                              <span class="at">rm_na =</span> <span class="cn">FALSE</span>,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>                              <span class="at">log_path =</span> log_file)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt; Filtering time-invariant dataset...</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; ✔ Filtered time-invariant dataset by &#39;y_birth and innvandringsgrunn&#39; column(s)</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; ℹ Filtered 29333 rows (97.7% removed)</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; Demographic dataset succesfully filtered</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; ── Data Summary ────────────────────────────────────────────────────────────────</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt; ── After filtering:</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt; ℹ Remaining number of rows: 691</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt; ℹ Remaining number of columns: 4</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt; tibble [691 × 4] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co">#&gt;  $ id               : chr [1:691] &quot;P000000704&quot; &quot;P000000886&quot; &quot;P000001615&quot; &quot;P000004197&quot; ...</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co">#&gt;  $ sex              : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 1 1 2 1 2 2 2 2 2 ...</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="co">#&gt;  $ y_birth          : int [1:691] 2016 2016 2011 2010 2014 2015 2012 2010 2016 2011 ...</span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a><span class="co">#&gt;  $ innvandringsgrunn: chr [1:691] &quot;ARB&quot; &quot;UKJ&quot; &quot;ARB&quot; &quot;UKJ&quot; ...</span></span></code></pre></div>
</div>
</div>
<div id="linkage" class="section level2">
<h2>Linkage</h2>
<p>After filtering the datasets, we can link them using the individuals
unique personal identifier. Depending on the type of analysis and
relevant variables, it might not be necessary to link any datasets.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>linked_diag_inv <span class="ot">&lt;-</span> <span class="fu">link_diag_demo</span>(<span class="at">data_diag =</span> filtered_diag_pattern,</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>                                  <span class="at">data_demo_inv =</span> filtered_invar,</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>                                  <span class="at">id_col =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>                                  <span class="at">log_path =</span> log_file)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt; Joining diagnostic data with time-invariant demographic data...</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt; ✔ Datasets succesfully linked: filtered_diag_pattern, filtered_invar</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; ── Data Summary ────────────────────────────────────────────────────────────────</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt; ℹ After joining added 3 columns to &#39;filtered_diag_pattern&#39;: sex, y_birth, and innvandringsgrunn</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt; ℹ Rows in &#39;filtered_diag_pattern&#39;: 691</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt; ℹ Rows in &#39;filtered_invar&#39;: 691</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt; ✔ Total matched rows: 691</span></span></code></pre></div>
<p>The resulting dataset from <code>link_diag_demo()</code>is a minimal
tidy dataset that you can then use to run other analytical
functions.</p>
</div>
<div id="analysis" class="section level2">
<h2>Analysis</h2>
</div>
<div id="visualize" class="section level2">
<h2>Visualize</h2>
</div>
<div id="other-useful-functions" class="section level2">
<h2>Other useful functions</h2>
<div id="simulate-dataset" class="section level3">
<h3>Simulate dataset</h3>
<p>Simulates a dataset. In some cases uses API, not able to be run
inside TSD</p>
</div>
<div id="harmonize-municipality-codes" class="section level3">
<h3>Harmonize municipality codes</h3>
<p>Harmonizes codes. Some of the challenges of working with
registries.</p>
</div>
<div id="get-population-ssb" class="section level3">
<h3>Get population SSB</h3>
<p>API SSB: not able to run inside of TSD</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
